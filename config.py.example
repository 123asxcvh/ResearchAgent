#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
é…ç½®æ¨¡å—ç¤ºä¾‹æ–‡ä»¶
å¤åˆ¶æ­¤æ–‡ä»¶ä¸º config.py å¹¶å¡«å…¥ä½ çš„ API å¯†é’¥
æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®
"""

import os
from typing import List, Dict, Any, Optional

# ==================== åŸºç¡€é…ç½®å˜é‡ ====================

# æ¨¡å‹é…ç½®
MODEL_NAME = "kimi-k2-thinking-turbo"
MODEL_BASE_URL = "https://api.moonshot.cn/v1"
# ä»ç¯å¢ƒå˜é‡è¯»å– API å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨å ä½ç¬¦
MODEL_API_KEY = os.getenv("KIMI_API_KEY", "your-kimi-api-key-here")  # è¯·è®¾ç½®ç¯å¢ƒå˜é‡ KIMI_API_KEY æˆ–æ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥
MODEL_TIMEOUT = 120.0
MODEL_MAX_RETRIES = 5
MODEL_TEMPERATURE = 0.7
MODEL_INFO = {
    "vision": False,           # KIMI ä¸æ”¯æŒè§†è§‰åŠŸèƒ½
    "function_calling": True,  # æ”¯æŒå‡½æ•°è°ƒç”¨
    "json_output": True,       # æ”¯æŒJSONè¾“å‡º
    "family": "KIMI",          # KIMIæ¨¡å‹ç³»åˆ—
    "structured_output": True, # æ”¯æŒç»“æ„åŒ–è¾“å‡º
}

# æ™ºèƒ½ä½“é…ç½® - GraphFlowå›¢é˜Ÿï¼ˆåŸºäºä»»åŠ¡åˆ†é…ï¼‰
AGENT_NAMES = [
    "coordinator_agent",       # åè°ƒè€… + èƒŒæ™¯ç ”ç©¶
    "company_analyst",         # å…¬å¸ä¿¡æ¯åˆ†æå¸ˆ
    "financial_analyst",       # è´¢åŠ¡æ•°æ®åˆ†æå¸ˆ
    "industry_analyst",        # è¡Œä¸šåˆ†æå¸ˆ
    "market_analyst",          # å¸‚åœºåˆ†æå¸ˆ
    "news_analyst",            # æ–°é—»åˆ†æå¸ˆ
    "technical_analyst",       # æŠ€æœ¯åˆ†æå¸ˆ
    "strategy_advisor"         # ç­–ç•¥é¡¾é—® - ç»¼åˆåˆ†æå’ŒæŠ•èµ„å»ºè®®
]
AGENT_ROLES = [
    "åè°ƒè€…", "å…¬å¸ä¿¡æ¯åˆ†æå¸ˆ", "è´¢åŠ¡æ•°æ®åˆ†æå¸ˆ",
    "è¡Œä¸šåˆ†æå¸ˆ", "å¸‚åœºåˆ†æå¸ˆ", "æ–°é—»åˆ†æå¸ˆ", "æŠ€æœ¯åˆ†æå¸ˆ", "ç­–ç•¥é¡¾é—®"
]
AGENT_MAX_TOOL_ITERATIONS = 10
AGENT_REFLECT_ON_TOOL_USE = True

# ==================== é…ç½®å­—å…¸ ====================

# æ¨¡å‹é…ç½®å­—å…¸
MODEL_CONFIG = {
    "name": MODEL_NAME,
    "api_key": MODEL_API_KEY,
    "base_url": MODEL_BASE_URL,
    "timeout": MODEL_TIMEOUT,
    "max_retries": MODEL_MAX_RETRIES,
    "temperature": MODEL_TEMPERATURE,
    "model_info": MODEL_INFO,
}

# æ™ºèƒ½ä½“é…ç½®åˆ—è¡¨
AGENTS_CONFIG = [
    {
        "name": name,
        "role": role,
        "max_tool_iterations": AGENT_MAX_TOOL_ITERATIONS,
        "reflect_on_tool_use": AGENT_REFLECT_ON_TOOL_USE,
    }
    for name, role in zip(AGENT_NAMES, AGENT_ROLES)
]

# MCPæœåŠ¡å™¨é…ç½®åˆ—è¡¨ - ç§»é™¤filesystemï¼Œåªä½¿ç”¨ç½‘ç»œæœç´¢å·¥å…·
MCP_SERVERS_CONFIG = [
    # Tavilyæœç´¢å·¥å…· - ç½‘é¡µæœç´¢å’Œä¿¡æ¯æœé›†
    {
        "name": "tavily",
        "command": "npx",
        "args": ["-y", "tavily-mcp@0.2.1"],
        "env": {
            "TAVILY_API_KEY": os.getenv("TAVILY_API_KEY", "your-tavily-api-key-here")  # è¯·è®¾ç½®ç¯å¢ƒå˜é‡ TAVILY_API_KEY
        },
        "agents": ["coordinator_agent", "company_analyst", "financial_analyst", "industry_analyst", "market_analyst", "news_analyst", "technical_analyst"]
    },
  
    # é¡ºåºæ€è€ƒå·¥å…· - æ·±åº¦æ€è€ƒå’Œåˆ†æ
    {
        "name": "sequentialthinking",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"],
        "agents": ["coordinator_agent"]  # åªæœ‰åè°ƒè€…éœ€è¦æ·±åº¦æ€è€ƒå·¥å…·
    },
]

# é¡¹ç›®æ€»é…ç½®
PROJECT_CONFIG = {
    "model": MODEL_CONFIG,
    "agents": AGENTS_CONFIG,
    "mcp_servers": MCP_SERVERS_CONFIG,
}

# ==================== é…ç½®è®¿é—®å‡½æ•° ====================

def get_model_config() -> Dict[str, Any]:
    """è·å–æ¨¡å‹é…ç½®"""
    return PROJECT_CONFIG["model"]


def get_agent_config(agent_name: str) -> Optional[Dict[str, Any]]:
    """è·å–æŒ‡å®šæ™ºèƒ½ä½“é…ç½®"""
    for agent in PROJECT_CONFIG["agents"]:
        if agent["name"] == agent_name:
            return agent
    return None
    

def get_mcp_servers() -> List[Dict[str, Any]]:
    """è·å–MCPæœåŠ¡å™¨é…ç½®"""
    return PROJECT_CONFIG["mcp_servers"]


def print_config():
    """æ‰“å°å½“å‰é…ç½®"""
    print("ğŸ“‹ å½“å‰é…ç½®:")
    print(f"   æ¨¡å‹åç§°: {PROJECT_CONFIG['model']['name']}")
    print(f"   APIåœ°å€: {PROJECT_CONFIG['model']['base_url']}")
    print(f"   è¶…æ—¶æ—¶é—´: {PROJECT_CONFIG['model']['timeout']}ç§’")
    print(f"   æœ€å¤§é‡è¯•: {PROJECT_CONFIG['model']['max_retries']}æ¬¡")
    print(f"   æ™ºèƒ½ä½“æ•°é‡: {len(PROJECT_CONFIG['agents'])}")
    print(f"   MCPæœåŠ¡å™¨æ•°é‡: {len(get_mcp_servers())}")
    print(f"   APIå¯†é’¥: {'å·²é…ç½®' if PROJECT_CONFIG['model']['api_key'] and PROJECT_CONFIG['model']['api_key'] != 'your-kimi-api-key-here' else 'æœªé…ç½®'}")

